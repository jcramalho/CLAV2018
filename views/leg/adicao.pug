extends ../layout
block corpo
    #nova-legislacao-form.panel.panel-default.panel-custom
        .panel-heading
            h1.page-header Novo Diploma
        .panel-body
            .form-group
                table.consulta(style="border-color: white; border-style:solid; margin-bottom:20px")

                    //- Tipo
                    tr
                        td(style="width: 10%")
                            .info-label Tipo de diploma: 
                        td(style="width:80%")
                            select(v-model="diploma.tipo")
                               option(v-for="t in tipoDiploma" :value="t.termo") {{ t.termo }}

                    //- Número
                    tr
                        td(style="width: 10%")
                            .info-label Número: 
                        td(style="width:80%")
                            input(
                                size="50"
                                v-model="diploma.numero"
                                pattern="[0-9]+(\-\w)?/[0-9]+"
                                placeholder=" NNNNNN/AAAA"
                                maxlength="11"
                            )
                        
                    //- Data
                    tr
                        td(style="width: 10%")
                            .info-label Data: 
                        td(style="width:80%")
                            datepicker(
                                value=""
                                @input="dataEscolhida($event)"
                                format="yyyy/MM/dd"
                                placeholder="AAAA/MM/DD"
                            )
                        

                    //- Entidades
                    tr(style="padding-bottom:30px")
                        td(style="width: 10%")
                            .info-label Entidade responsável pela publicação:

                        td
                            .col-sm-10
                                .row(v-if="entidades.length > 0")
                                    table.table.table-condensed.table-hover
                                        tr
                                            th Sigla 
                                            th Designação
                                            th Ação
                                        tr(v-for="(p, index) in entidades")
                                            td {{p.data[0]}}
                                            td {{p.data[1]}}
                                            td 
                                                button.btn.btn-default(type="button")
                                                    span.glyphicon.glyphicon-remove(@click="desselecionarEntidade(p, index)") 

                                accordion
                                    panel(type="white" header="Selecionar Entidades")
                                        select-row-from-table(
                                            v-if="entidadesReady"

                                            :header="orgsTableHeader"
                                            :complete-rows="orgs"
                                            :ready="entidadesReady"
                                            :cwidth="orgsTableWidth"
                                            
                                            class-table='table table-condensed'

                                            @select-clicked="selecionarEntidade($event)"
                                        )
                                        h4(
                                            v-else
                                        ) A carregar...

                    //- Sumário
                    tr
                        td(style="width: 10%")
                            .info-label Sumario: 
                        td(style="width:80%")
                            input(
                                size="150"
                                v-model="diploma.sumario"
                            )
       
                    //- Link
                    tr
                        td(style="width: 10%")
                            .info-label Link: 
                        td(style="width:80%")
                            input(
                                size="50"
                                v-model="diploma.link"
                            )

                    //- PROCESSOS
                    tr(style="padding-bottom:30px")
                        td(style="width: 10%")
                            .info-label Regula os Processos de Negócio:
                        td
                            .col-sm-10
                                .row(v-if="newProcessos.length > 0")
                                    table.table.table-condensed.table-hover
                                        tr
                                            th Processo
                                            th Ação
                                        tr(v-for="(p, index) in newProcessos")
                                            td {{p.data[0]}}
                                            td 
                                                button.btn.btn-default(type="button")
                                                    span.glyphicon.glyphicon-remove(@click="desselecionarProcesso(p, index)") 

                                accordion
                                    panel(type="white" header="Selecionar Processos de Negócio")
                                        select-row-from-table(
                                            v-if="classesReady"

                                            :header=["Processo"]
                                            :complete-rows="listaClasses"
                                            :ready="classesReady"
                                            :cwidth=["100%"]
                                            
                                            class-table='table table-condensed'

                                            @select-clicked="selecionarProcesso($event)"
                                        )
                                        h4(
                                            v-else
                                        ) A carregar...

            spinner(ref="spinner" size="lg" fixed text="Por favor aguarde...")

            input.btn.btn-xs.btn-default.col-sm-2(
                type="button" 
                @click="add" 
                value="Submeter nova Legislação" 
                :disabled="!readyToCreate()"

                style="margin-right:10px"
            )
            div(v-html="message")

    //-
    

append scripts    
    script(src="/javascripts/leg/adicao.vue")
    script(src="/javascripts/component-select-row-from-table.vue")